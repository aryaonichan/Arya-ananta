// routes/web.php

use App\Http\Controllers\ProductController;

Route::get('/', function () { return redirect()->route('products.index'); }); Route::resource('products', ProductController::class);

// app/Models/Category.php

namespace App\Models; use Illuminate\Database\Eloquent\Model;

class Category extends Model { protected $fillable = ['name'];

public function products() {
    return $this->hasMany(Product::class);
}

}

// app/Models/Product.php

namespace App\Models; use Illuminate\Database\Eloquent\Model;

class Product extends Model { protected $fillable = [ 'name', 'description', 'price', 'category_id', 'is_publish', 'published_at' ];

public function category() {
    return $this->belongsTo(Category::class);
}

}

// database/migrations/2025_07_17_000000_create_categories_table.php

use Illuminate\Database\Migrations\Migration; use Illuminate\Database\Schema\Blueprint; use Illuminate\Support\Facades\Schema;

return new class extends Migration { public function up() { Schema::create('categories', function (Blueprint $table) { $table->id(); $table->string('name'); $table->timestamps(); }); }

public function down() {
    Schema::dropIfExists('categories');
}

};

// database/migrations/2025_07_17_000001_create_products_table.php

use Illuminate\Database\Migrations\Migration; use Illuminate\Database\Schema\Blueprint; use Illuminate\Support\Facades\Schema;

return new class extends Migration { public function up() { Schema::create('products', function (Blueprint $table) { $table->id(); $table->string('name'); $table->text('description')->nullable(); $table->decimal('price', 12, 2); $table->foreignId('category_id')->constrained()->onDelete('cascade'); $table->boolean('is_publish')->default(false); $table->timestamp('published_at')->nullable(); $table->timestamps(); }); }

public function down() {
    Schema::dropIfExists('products');
}

};

// database/seeders/CategorySeeder.php

namespace Database\Seeders; use Illuminate\Database\Seeder; use App\Models\Category;

class CategorySeeder extends Seeder { public function run() { Category::insert([ ['name' => 'Elektronik'], ['name' => 'Pakaian'], ['name' => 'Makanan'], ]); } }

// database/seeders/ProductSeeder.php

namespace Database\Seeders; use Illuminate\Database\Seeder; use App\Models\Product;

class ProductSeeder extends Seeder { public function run() { Product::factory()->count(5)->create(); } }

// app/Http/Controllers/ProductController.php

namespace App\Http\Controllers; use Illuminate\Http\Request; use App\Models\Product; use App\Models\Category;

class ProductController extends Controller { public function index() { $products = Product::with('category')->get(); return view('products.index', compact('products')); }

public function create() {
    $categories = Category::all();
    return view('products.create', compact('categories'));
}

public function store(Request $request) {
    $validated = $request->validate([
        'name' => 'required',
        'description' => 'nullable',
        'price' => 'required|numeric',
        'category_id' => 'required|exists:categories,id',
        'is_publish' => 'nullable|boolean',
        'published_at' => 'nullable|date'
    ]);

    Product::create($validated);
    return redirect()->route('products.index')->with('success', 'Produk berhasil ditambahkan.');
}

public function edit(Product $product) {
    $categories = Category::all();
    return view('products.edit', compact('product', 'categories'));
}

public function update(Request $request, Product $product) {
    $validated = $request->validate([
        'name' => 'required',
        'description' => 'nullable',
        'price' => 'required|numeric',
        'category_id' => 'required|exists:categories,id',
        'is_publish' => 'nullable|boolean',
        'published_at' => 'nullable|date'
    ]);

    $product->update($validated);
    return redirect()->route('products.index')->with('success', 'Produk berhasil diperbarui.');
}

public function destroy(Product $product) {
    $product->delete();
    return redirect()->route('products.index')->with('success', 'Produk berhasil dihapus.');
}

}
